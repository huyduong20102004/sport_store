{% extends "base.html" %}

{% block title %}Sản phẩm - SportZone{% endblock %}

{% block content %}
<!-- Hero Header -->
<div style="background: linear-gradient(135deg, rgba(37, 99, 235, 0.1) 0%, rgba(245, 158, 11, 0.1) 100%); padding: 3rem 2rem; border-radius: 20px; margin-bottom: 2rem; text-align: center; border: 1px solid var(--border);">
  <h1 style="font-size: 2.5rem; font-weight: 800; color: var(--dark); margin-bottom: 1rem;">
    <svg class="custom-icon" style="width: 45px; height: 45px; vertical-align: middle; color: var(--primary);" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <path d="M16 10a4 4 0 0 1-8 0"></path>
    </svg>
    Sản Phẩm Thể Thao
  </h1>
  <p style="font-size: 1.1rem; color: var(--text); max-width: 700px; margin: 0 auto;">
    Khám phá bộ sưu tập đồ thể thao chất lượng cao từ các thương hiệu hàng đầu
  </p>
</div>

<!-- Search Form -->
<form id="searchForm" action="{{ url_for('products_page') }}" method="get" style="margin-bottom: 2rem; display: flex; gap: 1rem; background: white; padding: 1.5rem; border-radius: 16px; box-shadow: var(--shadow); border: 1px solid var(--border);">
  <div style="flex: 1; position: relative;">
    <svg style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); width: 20px; height: 20px; color: var(--text-light);" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="11" cy="11" r="8"></circle>
      <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
    </svg>
    <input name="q" value="{{ q }}" placeholder="Tìm kiếm sản phẩm (theo tên, mô tả, danh mục...)" 
           style="width: 100%; padding: 0.875rem 1rem 0.875rem 3rem; border: 2px solid var(--border); border-radius: 10px; font-size: 1rem; font-family: 'Poppins', sans-serif; transition: var(--transition);" />
  </div>
  <button type="submit" style="padding: 0.875rem 2rem; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white; border: none; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; transition: var(--transition); box-shadow: var(--shadow-md);">
    <svg style="width: 18px; height: 18px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="11" cy="11" r="8"></circle>
      <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
    </svg>
    Tìm kiếm
  </button>
</form>

<!-- Product Grid -->
<div class="product-grid">
  {% for p in products %}
  <div class="product-card-modern">
    <div class="product-image-wrapper">
      <img src="{{ p['image_url'] }}" alt="{{ p['name'] }}" loading="lazy">
      <div class="product-overlay">
        <button class="quick-view-btn" data-id="{{ p['id'] }}">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
          Xem nhanh
        </button>
      </div>
      {% if loop.index <= 3 %}
      <span class="product-badge hot">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2c1.6 3.4 2 5 2 7 0 2.8-2.2 5-5 5s-5-2.2-5-5c0-1 .2-2 .5-2.9L12 2zm-2 15.5c-.8-.8-1.5-1.8-2-2.9-.5-.9-.8-1.9-.8-2.9 0-.6.1-1.1.2-1.6 1.2 2.4 3.9 4.4 6.8 4.4h.1c-.2 1.6-1.2 3-2.5 3.9-1 .7-2.2 1.1-3.5 1.1-1.6 0-3.1-.6-4.2-1.6 1.2.6 2.6.9 4 .9.6 0 1.2-.1 1.8-.3z"/>
        </svg>
        Hot
      </span>
      {% elif p['category'] == 'Shoes' %}
      <span class="product-badge new">Mới</span>
      {% elif p['price'] < 500000 %}
      <span class="product-badge sale">Giá tốt</span>
      {% endif %}
    </div>
    <div class="product-card-body">
      <div class="product-category">{{ p['category'] }}</div>
      <h3 class="product-title">{{ p['name'] }}</h3>
      <p class="product-description">{{ p['description'][:90] }}{% if p['description']|length > 90 %}...{% endif %}</p>
      <div class="product-footer">
        <div class="product-price">
          <span class="price-amount">{{ "{:,.0f}".format(p['price']) }}</span>
          <span class="price-currency">VND</span>
        </div>
        <div class="product-actions">
          <input type="number" min="1" value="1" max="99" class="product-qty" id="qty-{{ p['id'] }}" title="Số lượng">
          <button class="add-to-cart-btn" data-id="{{ p['id'] }}">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg>
            Thêm
          </button>
        </div>
      </div>
    </div>
  </div>
  {% else %}
  <div style="grid-column: 1/-1; text-align: center; padding: 4rem 2rem; background: white; border-radius: 20px; box-shadow: var(--shadow);">
    <svg style="width: 100px; height: 100px; color: var(--text-light); margin-bottom: 1.5rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
      <path d="M20 7h-4V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2H4a1 1 0 0 0-1 1v11a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8a1 1 0 0 0-1-1zM10 5h4v2h-4V5z"></path>
    </svg>
    <h3 style="font-size: 1.5rem; color: var(--dark); margin-bottom: 0.5rem;">Không tìm thấy sản phẩm</h3>
    <p style="color: var(--text-light);">Thử tìm kiếm với từ khóa khác</p>
  </div>
  {% endfor %}
</div>

<!-- Pagination -->
{% if total_pages > 1 %}
<div style="display: flex; justify-content: center; align-items: center; gap: 1rem; margin-top: 3rem; padding: 1.5rem; background: white; border-radius: 16px; box-shadow: var(--shadow);">
  {% if page > 1 %}
    <a href="{{ url_for('products_page') }}?q={{ q }}&page={{ page-1 }}" 
       style="padding: 0.875rem 1.5rem; background: var(--primary); color: white; text-decoration: none; border-radius: 10px; font-weight: 600; transition: var(--transition); display: flex; align-items: center; gap: 0.5rem; box-shadow: var(--shadow-md);">
      <svg style="width: 16px; height: 16px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
      Trang trước
    </a>
  {% endif %}
  
  <span style="padding: 0.875rem 1.5rem; background: var(--bg-light); border-radius: 10px; font-weight: 600; color: var(--text);">
    Trang {{ page }} / {{ total_pages }}
  </span>
  
  {% if page < total_pages %}
    <a href="{{ url_for('products_page') }}?q={{ q }}&page={{ page+1 }}" 
       style="padding: 0.875rem 1.5rem; background: var(--primary); color: white; text-decoration: none; border-radius: 10px; font-weight: 600; transition: var(--transition); display: flex; align-items: center; gap: 0.5rem; box-shadow: var(--shadow-md);">
      Trang sau
      <svg style="width: 16px; height: 16px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    </a>
  {% endif %}
</div>
{% endif %}

<!-- Quick View Modal -->
<div id="quickViewModal" class="quick-view-modal" style="display: none;">
  <div class="quick-view-overlay" onclick="closeQuickView()"></div>
  <div class="quick-view-content">
    <button class="quick-view-close" onclick="closeQuickView()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
    
    <div class="quick-view-grid">
      <!-- Product Image -->
      <div class="quick-view-image">
        <img id="quickViewImage" src="" alt="">
        <div class="quick-view-thumbnails" id="quickViewThumbnails">
          <!-- Thumbnails will be inserted here -->
        </div>
      </div>
      
      <!-- Product Details -->
      <div class="quick-view-details">
        <div class="quick-view-category" id="quickViewCategory"></div>
        <h2 class="quick-view-title" id="quickViewTitle"></h2>
        <div class="quick-view-price">
          <span class="price-large" id="quickViewPrice"></span>
          <span class="price-currency">VND</span>
        </div>
        
        <p class="quick-view-description" id="quickViewDescription"></p>
        
        <!-- Color Selection -->
        <div class="option-group">
          <label class="option-label">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
            </svg>
            Màu sắc
          </label>
          <div class="color-options" id="colorOptions">
            <button class="color-btn active" data-color="Đen" style="background: #000;"></button>
            <button class="color-btn" data-color="Trắng" style="background: #fff; border: 2px solid #ddd;"></button>
            <button class="color-btn" data-color="Xanh dương" style="background: #2563eb;"></button>
            <button class="color-btn" data-color="Đỏ" style="background: #ef4444;"></button>
            <button class="color-btn" data-color="Xám" style="background: #6b7280;"></button>
          </div>
          <div class="selected-option" id="selectedColor">Đã chọn: <strong>Đen</strong></div>
        </div>
        
        <!-- Size Selection -->
        <div class="option-group">
          <label class="option-label">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2"></rect>
              <path d="M9 3v18M15 3v18M3 9h18M3 15h18"></path>
            </svg>
            Kích thước
          </label>
          <div class="size-options" id="sizeOptions">
            <button class="size-btn" data-size="S">S</button>
            <button class="size-btn active" data-size="M">M</button>
            <button class="size-btn" data-size="L">L</button>
            <button class="size-btn" data-size="XL">XL</button>
            <button class="size-btn" data-size="XXL">XXL</button>
          </div>
          <div class="selected-option" id="selectedSize">Đã chọn: <strong>M</strong></div>
        </div>
        
        <!-- Quantity & Add to Cart -->
        <div class="quick-view-actions">
          <div class="quantity-selector">
            <button class="qty-btn" onclick="decreaseQty()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
            </button>
            <input type="number" id="quickViewQty" value="1" min="1" max="99" readonly>
            <button class="qty-btn" onclick="increaseQty()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
            </button>
          </div>
          
          <button class="add-to-cart-large" onclick="addToCartFromQuickView()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg>
            Thêm vào giỏ hàng
          </button>
        </div>
        
        <!-- Product Features -->
        <div class="product-features">
          <div class="feature-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            <span>Miễn phí vận chuyển</span>
          </div>
          <div class="feature-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            <span>Đổi trả trong 7 ngày</span>
          </div>
          <div class="feature-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            <span>Hàng chính hãng 100%</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.product-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.product-card-modern {
  background: white;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: var(--shadow);
  transition: var(--transition);
  border: 1px solid var(--border);
  display: flex;
  flex-direction: column;
}

.product-card-modern:hover {
  transform: translateY(-8px);
  box-shadow: var(--shadow-lg);
}

.product-image-wrapper {
  position: relative;
  width: 100%;
  height: 260px;
  overflow: hidden;
  background: var(--bg-light);
}

.product-image-wrapper img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.5s ease;
}

.product-card-modern:hover .product-image-wrapper img {
  transform: scale(1.1);
}

.product-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: var(--transition);
}

.product-card-modern:hover .product-overlay {
  opacity: 1;
}

.quick-view-btn {
  padding: 0.75rem 1.5rem;
  background: white;
  color: var(--dark);
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: var(--transition);
  font-family: 'Poppins', sans-serif;
}

.quick-view-btn svg {
  width: 18px;
  height: 18px;
}

.quick-view-btn:hover {
  background: var(--primary);
  color: white;
  transform: scale(1.05);
}

.product-badge {
  position: absolute;
  top: 1rem;
  right: 1rem;
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  display: flex;
  align-items: center;
  gap: 0.3rem;
  z-index: 2;
  box-shadow: var(--shadow-md);
}

.product-badge.hot {
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  color: white;
}

.product-badge.hot svg {
  width: 14px;
  height: 14px;
}

.product-badge.new {
  background: linear-gradient(135deg, var(--accent-green) 0%, #059669 100%);
  color: white;
}

.product-badge.sale {
  background: linear-gradient(135deg, var(--accent-red) 0%, #dc2626 100%);
  color: white;
}

.product-card-body {
  padding: 1.5rem;
  display: flex;
  flex-direction: column;
  flex: 1;
}

.product-category {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--primary);
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 0.5rem;
}

.product-title {
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--dark);
  margin-bottom: 0.5rem;
  line-height: 1.3;
  min-height: 2.6rem;
}

.product-description {
  font-size: 0.85rem;
  color: var(--text-light);
  line-height: 1.5;
  margin-bottom: 1rem;
  flex: 1;
}

.product-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
  padding-top: 1rem;
  border-top: 1px solid var(--border);
}

.product-price {
  display: flex;
  flex-direction: column;
}

.price-amount {
  font-size: 1.5rem;
  font-weight: 800;
  color: var(--primary);
  line-height: 1;
}

.price-currency {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--text-light);
  margin-top: 0.2rem;
}

.product-actions {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}

.product-qty {
  width: 50px;
  padding: 0.5rem;
  border: 2px solid var(--border);
  border-radius: 6px;
  text-align: center;
  font-weight: 600;
  font-family: 'Poppins', sans-serif;
}

.add-to-cart-btn {
  padding: 0.75rem 1rem;
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color: white;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-family: 'Poppins', sans-serif;
  box-shadow: var(--shadow-md);
}

.add-to-cart-btn svg {
  width: 18px;
  height: 18px;
}

.add-to-cart-btn:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.add-to-cart-btn:active {
  transform: translateY(0);
}

@media (max-width: 768px) {
  .product-grid {
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 1rem;
  }
  
  .product-image-wrapper {
    height: 200px;
  }
  
  .product-card-body {
    padding: 1rem;
  }
  
  .product-title {
    font-size: 1rem;
  }
  
  .price-amount {
    font-size: 1.3rem;
  }
  
  form button {
    padding: 0.875rem 1.25rem !important;
  }
  
  form button span {
    display: none;
  }
}

/* Quick View Modal Styles */
.quick-view-modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 10000;
  display: flex;
  align-items: center;
  justify-content: center;
  animation: fadeIn 0.3s ease;
}

.quick-view-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(8px);
}

.quick-view-content {
  position: relative;
  background: white;
  border-radius: 24px;
  max-width: 1000px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: var(--shadow-lg);
  animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.quick-view-close {
  position: absolute;
  top: 1.5rem;
  right: 1.5rem;
  background: rgba(0, 0, 0, 0.05);
  border: none;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: var(--transition);
  z-index: 10;
}

.quick-view-close svg {
  width: 20px;
  height: 20px;
  color: var(--dark);
}

.quick-view-close:hover {
  background: rgba(239, 68, 68, 0.1);
  transform: rotate(90deg);
}

.quick-view-close:hover svg {
  color: var(--accent-red);
}

.quick-view-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 3rem;
  padding: 3rem;
}

.quick-view-image {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.quick-view-image > img {
  width: 100%;
  height: 450px;
  object-fit: cover;
  border-radius: 16px;
  box-shadow: var(--shadow-md);
}

.quick-view-thumbnails {
  display: flex;
  gap: 0.75rem;
  overflow-x: auto;
}

.quick-view-thumbnails img {
  width: 80px;
  height: 80px;
  object-fit: cover;
  border-radius: 8px;
  cursor: pointer;
  border: 2px solid transparent;
  transition: var(--transition);
}

.quick-view-thumbnails img:hover,
.quick-view-thumbnails img.active {
  border-color: var(--primary);
}

.quick-view-details {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.quick-view-category {
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--primary);
  text-transform: uppercase;
  letter-spacing: 1px;
}

.quick-view-title {
  font-size: 2rem;
  font-weight: 700;
  color: var(--dark);
  line-height: 1.2;
  margin: 0;
}

.quick-view-price {
  display: flex;
  align-items: baseline;
  gap: 0.5rem;
  padding: 1rem 0;
  border-bottom: 2px solid var(--border);
}

.price-large {
  font-size: 2.5rem;
  font-weight: 800;
  color: var(--primary);
  line-height: 1;
}

.quick-view-description {
  color: var(--text);
  line-height: 1.8;
  font-size: 0.95rem;
}

.option-group {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.option-label {
  font-weight: 600;
  color: var(--dark);
  font-size: 0.95rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.option-label svg {
  width: 18px;
  height: 18px;
  color: var(--primary);
}

.color-options {
  display: flex;
  gap: 0.75rem;
  flex-wrap: wrap;
}

.color-btn {
  width: 45px;
  height: 45px;
  border-radius: 50%;
  border: 3px solid transparent;
  cursor: pointer;
  transition: var(--transition);
  box-shadow: var(--shadow-sm);
}

.color-btn:hover {
  transform: scale(1.1);
}

.color-btn.active {
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
}

.size-options {
  display: flex;
  gap: 0.75rem;
  flex-wrap: wrap;
}

.size-btn {
  padding: 0.75rem 1.5rem;
  border: 2px solid var(--border);
  border-radius: 8px;
  background: white;
  font-weight: 600;
  font-size: 0.95rem;
  cursor: pointer;
  transition: var(--transition);
  min-width: 60px;
}

.size-btn:hover {
  border-color: var(--primary);
  background: rgba(37, 99, 235, 0.05);
}

.size-btn.active {
  border-color: var(--primary);
  background: var(--primary);
  color: white;
}

.selected-option {
  font-size: 0.85rem;
  color: var(--text-light);
  margin-top: 0.25rem;
}

.selected-option strong {
  color: var(--dark);
}

.quick-view-actions {
  display: flex;
  gap: 1rem;
  margin-top: 1rem;
}

.quantity-selector {
  display: flex;
  align-items: center;
  border: 2px solid var(--border);
  border-radius: 10px;
  overflow: hidden;
  background: white;
}

.qty-btn {
  width: 45px;
  height: 50px;
  background: white;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition);
}

.qty-btn svg {
  width: 18px;
  height: 18px;
  color: var(--dark);
}

.qty-btn:hover {
  background: var(--bg-light);
}

.quantity-selector input {
  width: 60px;
  height: 50px;
  border: none;
  text-align: center;
  font-weight: 700;
  font-size: 1.1rem;
  color: var(--dark);
  background: transparent;
}

.add-to-cart-large {
  flex: 1;
  padding: 1rem 2rem;
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color: white;
  border: none;
  border-radius: 10px;
  font-weight: 700;
  font-size: 1.05rem;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  box-shadow: var(--shadow-md);
}

.add-to-cart-large svg {
  width: 22px;
  height: 22px;
}

.add-to-cart-large:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.product-features {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  padding: 1.5rem;
  background: var(--bg-light);
  border-radius: 12px;
  margin-top: 1rem;
}

.feature-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  color: var(--text);
  font-size: 0.9rem;
}

.feature-item svg {
  width: 18px;
  height: 18px;
  color: var(--accent-green);
  flex-shrink: 0;
}

@media (max-width: 768px) {
  .quick-view-grid {
    grid-template-columns: 1fr;
    padding: 2rem 1.5rem;
    gap: 2rem;
  }
  
  .quick-view-image > img {
    height: 300px;
  }
  
  .quick-view-title {
    font-size: 1.5rem;
  }
  
  .price-large {
    font-size: 2rem;
  }
  
  .quick-view-actions {
    flex-direction: column;
  }
  
  .quantity-selector {
    width: 100%;
    justify-content: center;
  }
}

</style>

<script>
  // Product data for quick view
  let currentProduct = null;
  
  // Quick View Modal Functions
  function openQuickView(productData) {
    currentProduct = productData;
    const modal = document.getElementById('quickViewModal');
    
    // Set product data
    document.getElementById('quickViewImage').src = productData.image;
    document.getElementById('quickViewCategory').textContent = productData.category;
    document.getElementById('quickViewTitle').textContent = productData.name;
    document.getElementById('quickViewPrice').textContent = productData.price;
    document.getElementById('quickViewDescription').textContent = productData.description;
    
    // Create thumbnails (using same image for demo, you can add more images)
    const thumbnails = document.getElementById('quickViewThumbnails');
    thumbnails.innerHTML = '';
    for (let i = 0; i < 3; i++) {
      const img = document.createElement('img');
      img.src = productData.image;
      img.className = i === 0 ? 'active' : '';
      img.onclick = function() {
        document.getElementById('quickViewImage').src = this.src;
        thumbnails.querySelectorAll('img').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
      };
      thumbnails.appendChild(img);
    }
    
    // Reset selections
    document.getElementById('quickViewQty').value = 1;
    document.querySelectorAll('.color-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector('.color-btn').classList.add('active');
    document.querySelectorAll('.size-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector('.size-btn[data-size="M"]').classList.add('active');
    
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
  }
  
  function closeQuickView() {
    document.getElementById('quickViewModal').style.display = 'none';
    document.body.style.overflow = 'auto';
  }
  
  function decreaseQty() {
    const input = document.getElementById('quickViewQty');
    const value = parseInt(input.value);
    if (value > 1) {
      input.value = value - 1;
    }
  }
  
  function increaseQty() {
    const input = document.getElementById('quickViewQty');
    const value = parseInt(input.value);
    if (value < 99) {
      input.value = value + 1;
    }
  }
  
  function addToCartFromQuickView() {
    const qty = document.getElementById('quickViewQty').value;
    const color = document.querySelector('.color-btn.active').dataset.color;
    const size = document.querySelector('.size-btn.active').dataset.size;
    
    if (!currentProduct) return;
    
    fetch('/add_to_cart', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        product_id: currentProduct.id,
        qty: qty
      })
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        const btn = document.querySelector('.add-to-cart-large');
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg> Đã thêm vào giỏ!';
        btn.style.background = 'linear-gradient(135deg, var(--accent-green) 0%, #059669 100%)';
        
        setTimeout(() => {
          btn.innerHTML = originalHTML;
          btn.style.background = 'linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%)';
          closeQuickView();
        }, 1500);
      } else {
        if (data.require_login) {
          closeQuickView();
          setTimeout(() => {
            openLoginModal();
          }, 300);
        } else {
          alert(data.error || 'Có lỗi xảy ra');
        }
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('Có lỗi xảy ra khi thêm sản phẩm');
    });
  }
  
  // Color selection
  document.addEventListener('click', function(e) {
    if (e.target.classList.contains('color-btn')) {
      document.querySelectorAll('.color-btn').forEach(btn => btn.classList.remove('active'));
      e.target.classList.add('active');
      document.getElementById('selectedColor').innerHTML = 'Đã chọn: <strong>' + e.target.dataset.color + '</strong>';
    }
    
    if (e.target.classList.contains('size-btn')) {
      document.querySelectorAll('.size-btn').forEach(btn => btn.classList.remove('active'));
      e.target.classList.add('active');
      document.getElementById('selectedSize').innerHTML = 'Đã chọn: <strong>' + e.target.dataset.size + '</strong>';
    }
  });
  
  // Quick view buttons
  document.querySelectorAll('.quick-view-btn').forEach(btn => {
    btn.addEventListener('click', function(e) {
      e.preventDefault();
      const card = this.closest('.product-card-modern');
      const productData = {
        id: this.dataset.id,
        name: card.querySelector('.product-title').textContent,
        category: card.querySelector('.product-category').textContent,
        price: card.querySelector('.price-amount').textContent,
        description: card.querySelector('.product-description').textContent,
        image: card.querySelector('.product-image-wrapper img').src
      };
      openQuickView(productData);
    });
  });
  
  // Close on ESC key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeQuickView();
    }
  });
  
  // Add to cart functionality
  document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const productId = this.dataset.id;
      const qty = document.getElementById('qty-' + productId).value;
      
      fetch('/add_to_cart', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          product_id: productId,
          qty: qty
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          const originalHTML = this.innerHTML;
          this.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg> Đã thêm';
          setTimeout(() => {
            this.innerHTML = originalHTML;
          }, 1500);
        } else {
          if (data.require_login) {
            // Show login modal
            openLoginModal();
          } else {
            alert(data.error || 'Có lỗi xảy ra');
          }
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Có lỗi xảy ra khi thêm sản phẩm');
      });
    });
  });

  // Search form enhancement
  const searchInput = document.querySelector('input[name="q"]');
  searchInput.addEventListener('focus', function() {
    this.style.borderColor = 'var(--primary)';
    this.style.boxShadow = '0 0 0 3px rgba(37, 99, 235, 0.1)';
  });
  searchInput.addEventListener('blur', function() {
    this.style.borderColor = 'var(--border)';
    this.style.boxShadow = 'none';
  });
</script>
{% endblock %}
